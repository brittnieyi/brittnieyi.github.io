---
title: "Final project report"
author: "Siting Lin, Nitin Jenson, Brittnie Yi"
output: html_notebook
---

### Research Question:

How do external, geographic factors, and pre-existing medical conditions affect the number of cases and death rates from the Coronavirus infection?

### Primary data:

This dataset is taken from https://www.worldometers.info/coronavirus/
The .CSV file for this dataset is called worldomemtersData.csv in the Github Repo.

### Secondary data:

This dataset is taken from https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3551445/
The .CSV file for this dataset is called ICUnumbers.csv in the Github Repo.

This dataset is taken from https://www.kaggle.com/folaraz/world-countries-and-continents-details
The .CSV file for this dataset is called countries and continents.csv in the Github Repo.


```{r}
# Load all packages needed
library(tidyverse)
library(ggplot2)
library(DataComputing)
library(rworldmap)
library(mosaic)
library(readr)
```

```{r}
# This step loads the primary and secondary datasets. Since the primary data will be updated everday, we chose to use data from the day that we finished the preliminary EDA.

file_name <- file.choose() 
Worldmeters_data <- 
  data.table::fread(file_name)  
Worldmeters_data

file_name2 <- file.choose() 
ICUnumbers <- 
  data.table::fread(file_name2)  
ICUnumbers

file_name3 <- file.choose() 
Continents <- 
  data.table::fread(file_name3)  
Continents
```

```{r}
# Inspection of imported data before analysis
# Using the function str() helps us see the structure of each dataset, such as its variables and variable types. 

str(Worldmeters_data)
str(ICUnumbers)
str(Continents)
```

The World Meters dataset contains 212 observations, 12 variables, and most of these variables are of 'chr' type besides the variable Deaths/1Mpop. The ICU numbers dataset contains 14 observations and 4 variables of different types. The Continents dataset contains 251 observations, which are all the different countries, and 27 variables.

```{r}
# This step cleans the data that we are going to use for analysis

ICUnew <-
  ICUnumbers %>%
  rename( Healthcare_cost = 'Per Capita Healthcare Cost**' ) %>% # Rename the variable for easy use
  mutate( Healthcare_cost = gsub(pattern = "[$]", replacement = " ", Healthcare_cost )) %>% # Edit all regular expressions
  rename( 'ICUbeds' = 'ICU beds per 100,000 people' )# For easy use, we abbreviated the variable's name
ICUnew

# Rename the variables in the data frame for ease and clarity, and select variables for analysis

Worldnew <- 
  Worldmeters_data %>%
  rename( Total_Cases = `Total Cases` ) %>%
  rename( Total_Death = `Total Deaths` ) %>%
  rename( Total_Recovered = 'Total Recovered' ) %>%
  rename( Total_Tests = `Total Tests` ) %>%
  select( Country, Total_Cases, Total_Death,Total_Recovered,Total_Tests)
Worldnew

# Repeat the renaming

Continent_new<-
  Continents %>%
  select( name, Continent ) %>%
  rename( Country = name )
Continent_new

```
```{r}
# Convert all characters to integers or numbers that can be used in analysis, and join ICU dataset and World Meters dataset

Combine_data <-
  ICUnew %>%
  inner_join( Worldnew, by = "Country" ) %>%
  filter( !Country == "Zambia" ) %>% # Zambia's data is not available in this set, so we deleted it
  mutate( Total_Cases = parse_number(Total_Cases) ) %>%
  mutate( Total_Death = parse_number(Total_Death) ) %>%
  mutate( Total_Recovered = parse_number(Total_Recovered) ) %>%
  mutate( Total_Tests = parse_number(Total_Tests) ) %>%
  mutate( Healthcare_cost = parse_number(Healthcare_cost) )
  
Combine_data

```


# The relationship between external factors and pre_existing medical conditions

We are going to explore the relationship between external factors, such as healthcare cost, pre-existing medical conditions, using ICU numbers of 100000 people, confirmed cases, and death rate.

### Step 1: The relationship between ICU numbers, death rate, and pre_existing medical conditions

The reason that we are using these data sets is because more developed countries with larger populations are able to provide more accurate data about ICU beds, health care costs, and data about confirmed coronavirus cases. There are a few possibilities about how humans can handle COVID 19, such as having a strong immune system and recovering from the virus in isolation, or be tranfered to the ICU that can provide better medical services and care. Therefore, we hypothesize that the numbers of ICU beds avaliable and variables such as death rate in different countries may have a relationship,and we are going to explore that using the data.

```{r}
#add the new variables named death rate
ICU_Death_Rela<-
  Combine_data%>%
  select(ICUbeds,Total_Death,Total_Cases,Country)%>%
  mutate(Deathrate = Total_Death/Total_Cases)
#When we check the numers of 
#ggplot the relationship between death rate and ICUbeds numbers in specific countries
ggplot(data = ICU_Death_Rela, aes(x = ICUbeds, y = Deathrate))+
  geom_point(aes(color = Country))
```

The data is a little bit small, so there is no obivious relationship between death rate and ICU numbers average, However, if we try to exclude some outliers, that is constrain the range of ICUbed from 5 to 10(of 100000 people), we can find something


```{r}
ggplot(data = ICU_Death_Rela, aes(x = ICUbeds, y = Deathrate))+
  geom_point(aes(color = Country))+
  xlim(5,10)
```

When we regulate the range of ICUbed, there is a really obviously decresing(negative) relationship between death rate and ICUbeds(rate).
### step2: The relationship between healthcare cost average and total comfirmed cases.
Since the tests that comfirmed the infection of CoronaVirus are expensive for most population, the countries that have higher healthcare cost may afford more tests for their population. We assume there is a relationship between total tests and healthcare cost in each countries.

```{r}
Health_Test_Rela<-
  Combine_data%>%
  select(Country, Healthcare_cost, Total_Tests)%>%
  mutate(Total_Tests_rate = Total_Tests/100)# for better illustrate in graph, we changed the variable of total tests to the tests rate of 100 people
ggplot(data = Health_Test_Rela, aes(x = Total_Tests_rate, y = Healthcare_cost))+
  geom_point(aes(color = Country))
```

According to the graph shown above, there is no obivious relationship between total tests rate and healthcare cost.

# The relationship between geographic factor and numbers of cases comfirmed


For futher exploring the relationship between geographic factor(continents) and total cases comfirmed, we are going to make a graph. 

```{r}
Con_Case_Rela<-
  Continent_new%>%
  inner_join(Worldnew)%>%
  mutate(Total_Cases = parse_number(Total_Cases))%>%
  mutate(Total_Death = parse_number(Total_Death))%>%
  filter(!Total_Death =="NA")%>%
  group_by(Continent)%>%
  summarise(Total_Cases_conti = sum(Total_Cases),
            Total_Death_conti = sum(Total_Death))%>%
  mutate(Deathrate_conti = Total_Death_conti/Total_Cases_conti)
ggplot(data = Con_Case_Rela, aes(x = Deathrate_conti, y = Total_Cases_conti))+
  geom_point(aes(color = Continent))
Con_Case_Rela
```


According to the graph above, we can know that there is a largeer population in Asia got comfirmed. Other total cases in each Continent are similar. However, there is a outlier which is Europe showing a really high death rate.
